# 公网部署后：用户如何安装扩展与本地打印服务并执行打印

本文面向**使用已部署到公网的标签设计系统、且需要在本机执行打印**的用户。按下面三步完成后，即可在浏览器中正常使用「连接打印」并出纸。

---

## 一、安装浏览器扩展（从商店）

1. 打开 **Chrome 浏览器**（或基于 Chromium 的 Edge 等）。
2. 打开扩展商店页面：
   - Chrome：访问 [Chrome 网上应用店](https://chrome.google.com/webstore)，搜索 **「连接打印扩展」**（或你们上架时填写的名称）；
   - 或通过你们提供的**扩展商店直达链接**安装。
3. 点击 **「添加至 Chrome」**（或「安装」），按提示完成安装。
4. 确认扩展已启用：地址栏输入 `chrome://extensions/`，找到该扩展，开关为**打开**状态。

> 若你们尚未上架商店，而是提供 **.zip 解压安装**：  
> 打开 `chrome://extensions/` → 开启「开发者模式」→「加载已解压的扩展程序」→ 选择解压后的 **extension** 文件夹。

---

## 二、下载并运行「本地打印服务」（local-print-service）

打印时，浏览器扩展会与您电脑上的「本地打印服务」通信，由该服务把 ZPL 发到本机打印机，因此需要先下载并启动该服务。

### 2.1 下载

- 从你们提供的渠道下载 **local-print-service**（例如：官网下载页、GitHub Releases、网盘链接等）。
- 下载得到的是一个压缩包（如 `local-print-service.zip`），解压到任意目录，例如：  
  `D:\local-print-service`  
  （路径中尽量不要有空格或特殊字符，避免后续报错。）

### 2.2 安装依赖（首次使用）

1. 打开 **命令提示符（CMD）** 或 **PowerShell**。
2. 进入解压后的目录，例如：
   ```bash
   cd D:\local-print-service
   ```
3. 执行：
   ```bash
   npm install
   ```
   等待依赖安装完成（本机需已安装 [Node.js](https://nodejs.org/)）。

### 2.3 启动服务

在同一目录下执行：

```bash
node server.js
```

看到类似 **「本地打印服务已启动: http://127.0.0.1:8765」** 即表示启动成功。**请保持该窗口不关闭**，关闭后无法打印。

- 每次需要使用「连接打印」前，都要先在本机执行一次上述命令并保持运行；
- 若你们提供了「一键启动」脚本或 exe，可改为双击该脚本/程序启动。

---

## 三、使用系统打印机（USB/本机）时：运行一次安装脚本（仅需一次）

若您要使用 **本机已安装的打印机**（如 USB 连接的 Zebra ZD621），在**首次**使用前需运行一次「打印计划任务」安装脚本，否则会提示「未找到打印计划任务」。

1. 在 **local-print-service** 解压目录下，找到 **`setup-print-task.bat`**。
2. **双击运行**（若弹出安全/病毒提示，请选择「允许」或「仍要运行」）。
3. 看到「计划任务 ZPLPrintFromNode 已创建」即表示成功，**以后无需再次运行**。

若只使用 **TCP 打印机**（通过 IP:9100 添加的打印机），可跳过本步。

---

## 四、在浏览器中执行打印

1. 在浏览器中打开你们部署的**公网地址**（如 `https://your-app.example.com`），并登录。
2. 进入 **「连接打印」** 页面。
3. 若左侧显示 **「打印扩展已连接」** 且能看到打印机列表，说明扩展与本地服务均正常。
4. 选择模板、选择打印机（系统打印机或 TCP 打印机），点击 **「打印当前行」** 或 **「批量打印」** 即可。

---

## 五、常见问题

| 现象 | 处理办法 |
|------|----------|
| 左侧提示「未检测到打印扩展」 | 确认已安装扩展并启用；**刷新当前页面（F5）** 后再试；或点击「重试检测扩展」。 |
| 提示「刷新打印机列表失败」或「获取打印机列表失败」 | 确认本机已**启动本地打印服务**（见第二节），且窗口未关闭。 |
| 选系统打印机后提示「未找到打印计划任务」 | 在 local-print-service 目录下**运行一次** `setup-print-task.bat`（见第三节）。 |
| 系统打印机无队列、不出纸 | 若打印机带网口，建议在「连接打印」页用 **TCP 方式** 添加（打印机 IP、端口 9100），再选该 TCP 打印机打印，通常更稳定。 |
| 运行 setup-print-task.bat 或打印时弹出安全/病毒提示 | 属计划任务或本地脚本触发的正常提示，选择 **允许** 或 **仍要运行** 即可。 |

---

## 六、流程小结

1. **安装扩展**（商店或解压安装）  
2. **下载并解压** local-print-service → 进入目录执行 `npm install`（首次）→ 执行 **`node server.js`** 并保持运行  
3. **使用系统打印机时**：首次前运行一次 **`setup-print-task.bat`**  
4. 打开公网页面 → 进入「连接打印」→ 选打印机并打印  

完成以上步骤后，即可在公网环境下正常执行打印命令。
